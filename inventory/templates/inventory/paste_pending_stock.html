{% extends 'inventory/base.html' %}
{% block title %}ì…ê³  ëŒ€ê¸° ë“±ë¡ (ë¶™ì—¬ë„£ê¸° í…Œì´ë¸”){% endblock %}

{% block content %}
<h2>ğŸ“‹ ì…ê³  ëŒ€ê¸° ë“±ë¡ - ì—‘ì…€ í…Œì´ë¸” ë¶™ì—¬ë„£ê¸°</h2>
<p>í‘œë¥¼ ë¶™ì—¬ë„£ì€ í›„ í™•ì¸ ì—†ì´ ë“±ë¡í•  ê²½ìš°, ì˜¤ë¥˜ê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë¶™ì—¬ë„£ì€ ë‚´ìš©ì´ ì •í™•í•œì§€ ê¼­ í™•ì¸í•˜ì„¸ìš”.</p>

<!-- Handsontable ìŠ¤íƒ€ì¼ê³¼ ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/handsontable@13.0.0/dist/handsontable.full.min.css" />
<script src="https://cdn.jsdelivr.net/npm/handsontable@13.0.0/dist/handsontable.full.min.js"></script>

<!-- âœ… placeholder ìŠ¤íƒ€ì¼ -->
<style>
  .htPlaceholder {
    color: #aaa !important;
    font-style: italic;
  }
</style>

<form id="pasteForm" method="POST">
  {% csrf_token %}
  <div id="hot" style="margin-top: 20px; width: 100%; max-width: 1000px;"></div>
  <input type="hidden" name="json_data" id="json_data">
  <br>
  <button type="submit" class="btn btn-primary">âœ… ì…ê³  ëŒ€ê¸° ë“±ë¡</button>
</form>

<script>
  function placeholderRenderer(instance, td, row, col, prop, value, cellProperties) {
    const placeholderTexts = ["2025-06-20", "ê±°ë˜ì²˜ëª…", "í˜„ìˆ˜ë§‰", "80í­", "5"];
    Handsontable.renderers.TextRenderer.apply(this, arguments);
    if (row === 0 && !value) {
      td.innerText = placeholderTexts[col];
      td.classList.add('htPlaceholder');
    } else {
      td.classList.remove('htPlaceholder');
    }
  }

  const container = document.getElementById('hot');
  const hot = new Handsontable(container, {
    data: [],
    colHeaders: ["ì…ê³ ë‚ ì§œ", "ê±°ë˜ì²˜ëª…", "í’ˆëª©ëª…", "ê·œê²©", "ìˆ˜ëŸ‰"],
    columns: [
      { type: 'text', renderer: placeholderRenderer },
      { type: 'text', renderer: placeholderRenderer },
      { type: 'text', renderer: placeholderRenderer },
      { type: 'text', renderer: placeholderRenderer },
      { type: 'numeric', renderer: placeholderRenderer },
    ],
    rowHeaders: true,
    minRows: 10,
    stretchH: 'all',
    contextMenu: true,
    licenseKey: 'non-commercial-and-evaluation'
  });

  document.getElementById('pasteForm').addEventListener('submit', function (e) {
    const data = hot.getData().filter(row => row.some(cell => cell !== null && cell !== ''));
    document.getElementById('json_data').value = JSON.stringify(data);
  });
</script>
{% endblock %}
